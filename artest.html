<html>

<body>
  Compass
  <div id="compassHeading"></div>
  <div id="destinationBearing"></div>
</body>

<script src="vendor/jquery/jquery.min.js"></script>
<script>
  function calcAngleDegrees(x, y) {
    return Math.atan2(y, x) * 180 / Math.PI;
  }

  function compassHeading(event) {
    var alpha = event.alpha;
    var beta = event.beta;
    var gamma = event.gamma;


    // Convert degrees to radians
    var alphaRad = alpha * (Math.PI / 180);
    var betaRad = beta * (Math.PI / 180);
    var gammaRad = gamma * (Math.PI / 180);

    // Calculate equation components
    var cA = Math.cos(alphaRad);
    var sA = Math.sin(alphaRad);
    var cB = Math.cos(betaRad);
    var sB = Math.sin(betaRad);
    var cG = Math.cos(gammaRad);
    var sG = Math.sin(gammaRad);

    // Calculate A, B, C rotation components
    var rA = - cA * sG - sA * sB * cG;
    var rB = - sA * sG + cA * sB * cG;
    var rC = - cB * cG;

    // Calculate compass heading
    var compassHeading = Math.atan(rA / rB);

    // Convert from half unit circle to whole unit circle
    if (rB < 0) {
      compassHeading += Math.PI;
    } else if (rA < 0) {
      compassHeading += 2 * Math.PI;
    }

    // Convert radians to degrees
    compassHeading *= 180 / Math.PI;


    $('#compassHeading').html("Direction: " + compassHeading);
    
    x2 = 0;
    y2 = 0;

    navigator.geolocation.getCurrentPosition(function(location) {
      x2 = location.coords.longitude;
      y2 = location.coords.latitude;
    });

    y = destination['y'] - y2;
    x = destination['x'] - x2;

    destinationBearing = calcAngleDegrees(x, y);
    
    if(destinationBearing < 0){
      destinationBearing = 360 - destinationBearing;
    }

    $('#compassHeading').html("Destinationn: " + destinationBearing);

  }

  // var x = document.getElementById("demo");
  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(showPosition);
    } else {
      x.innerHTML = "Geolocation is not supported by this browser.";
    }
  }
  function showPosition(position) {
    // x = position.coords.longitude;
    // y = position.coords.latitude;
    x.innerHTML = "Latitude: " + position.coords.latitude +
      "<br>Longitude: " + position.coords.longitude;
  }

  $(document).ready(function () {

    destination = [];
    destination['x'] = -106.443474; // LNG
    destination['y'] = 31.721604; // LAT

    window.addEventListener('deviceorientation', compassHeading);
    
    
  });

</script>

</html>